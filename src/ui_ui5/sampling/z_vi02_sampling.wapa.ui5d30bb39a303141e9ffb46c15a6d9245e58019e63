sap.ui.define([                                                                                                                                                                                                                                                
	"sap/ui/core/mvc/Controller",                                                                                                                                                                                                                                 
	// "sap/ui/core/mvc/XMLView",                                                                                                                                                                                                                                 
	"sap/m/MessageStrip",                                                                                                                                                                                                                                         
	"sap/base/Log",                                                                                                                                                                                                                                               
	"sap/ui/model/json/JSONModel",                                                                                                                                                                                                                                
	"sap/m/MessageToast",                                                                                                                                                                                                                                         
	"sap/m/MessageBox",                                                                                                                                                                                                                                           
	"sap/ui/Device",                                                                                                                                                                                                                                              
	"sap/ui/core/message/Message",                                                                                                                                                                                                                                
	"sap/ui/core/library",                                                                                                                                                                                                                                        
	"../libs/constants",                                                                                                                                                                                                                                          
], function (Controller, MessageStrip, Log, JSONModel, MessageToast, MessageBox, Device, Message, library, constants) {                                                                                                                                        
	"use strict";                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
	var oMessageManager;                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
	return Controller.extend("z_vi02_sampling.controller.BaseController", {                                                                                                                                                                                       
		whNumber: undefined,                                                                                                                                                                                                                                         
		workstation: undefined,                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
		// checkWhNumberAndWorkstation: function  checkWhNumberAndWorkstation() {                                                                                                                                                                                    
		// 	var queryString = window.location.search;                                                                                                                                                                                                                
		// 	console.log(queryString);                                                                                                                                                                                                                                
		// 	var urlParams = new URLSearchParams(queryString); // ?product=shirt&color=blue&newuser&size=m                                                                                                                                                            
                                                                                                                                                                                                                                                               
		// 	this.whNumber = urlParams.get('whnumber');                                                                                                                                                                                                               
		// 	this.workstation = urlParams.get('workstation');                                                                                                                                                                                                         
		// 	var that = this;                                                                                                                                                                                                                                         
		// 	if (!this.whNumber || !this.workstation) {                                                                                                                                                                                                               
		// 	  //change this url later                                                                                                                                                                                                                                
		// 	  var arr = window.location.pathname.split("/");                                                                                                                                                                                                         
		// 	  arr[arr.length - 2] = "zew_3dia_login";                                                                                                                                                                                                                
		// 	  var pathName = arr.join("/");                                                                                                                                                                                                                          
		// 	  var search = window.location.search;                                                                                                                                                                                                                   
		// 	  var appLocation = window.location.origin + pathName; //Send all the params to the login application                                                                                                                                                    
                                                                                                                                                                                                                                                               
		// 	  location.replace("".concat(appLocation, "?wsMode=PPUT&").concat(search.substring(1, search.length)));                                                                                                                                                  
		// 	 }&nbsp;                                                                                                                                                                                                                                                 
		//   },                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
		// initElementsModel: function() {                                                                                                                                                                                                                           
		// 	 var oModelData = new sap.ui.model.json.JSONModel();                                                                                                                                                                                                     
		// 	 oModelData.loadData("model/Elements.json");                                                                                                                                                                                                             
		// 	 this.getView().setModel(oModelData, "ELEMENTS");                                                                                                                                                                                                        
		// },                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
		// getElementsModel: function() {                                                                                                                                                                                                                            
		// 	return this.getView().getModel("ELEMENTS");                                                                                                                                                                                                              
		// },                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
		// initHeaderModel: function() {                                                                                                                                                                                                                             
		// 	 var oModelData = new sap.ui.model.json.JSONModel();                                                                                                                                                                                                     
		// 	 oModelData.loadData("model/Header.json");                                                                                                                                                                                                               
		// 	 this.getView().setModel(oModelData, "HEADER");                                                                                                                                                                                                          
		// },                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
		// getHeaderModel: function() {                                                                                                                                                                                                                              
		// 	return this.getView().getModel("HEADER");                                                                                                                                                                                                                
		// },                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
		// initMessageModel: function() {                                                                                                                                                                                                                            
		// 	// set message model                                                                                                                                                                                                                                     
		// 	oMessageManager = sap.ui.getCore().getMessageManager();                                                                                                                                                                                                  
		// 	this.getView().setModel(oMessageManager.getMessageModel(), "message");                                                                                                                                                                                   
                                                                                                                                                                                                                                                               
		// 	// or just do it for the whole view                                                                                                                                                                                                                      
		// 	oMessageManager.registerObject( this.getView(), true);                                                                                                                                                                                                   
		// },                                                                                                                                                                                                                                                        
		requestData: function (set, filterOptions, that, url) {                                                                                                                                                                                                      
			// triggers a get request via promise&nbsp;                                                                                                                                                                                                                 
			let me = this;                                                                                                                                                                                                                                              
			const baseUrl = url ? url : constants.service.url;                                                                                                                                                                                                          
			let promise = jQuery.Deferred();                                                                                                                                                                                                                            
			let filterArray = [];                                                                                                                                                                                                                                       
			let result = "";                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
			// build the filter array                                                                                                                                                                                                                                   
			filterOptions?.forEach(element => filterArray.push(new sap.ui.model.Filter(element.field, element.sign, element.value)));                                                                                                                                   
			// preapre the model using the base URL                                                                                                                                                                                                                     
			const oModel = new sap.ui.model.odata.ODataModel(baseUrl, true);                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
			// call the get request                                                                                                                                                                                                                                     
			oModel.read("/" + set, {                                                                                                                                                                                                                                    
				filters: filterArray,                                                                                                                                                                                                                                      
				success: (data) => {                                                                                                                                                                                                                                       
					// call was successfull => resolve the promise using the result                                                                                                                                                                                           
					if (data == null) {                                                                                                                                                                                                                                       
						result = me._buildMockData();                                                                                                                                                                                                                            
					} else {                                                                                                                                                                                                                                                  
						result = JSON.parse(JSON.stringify(data));                                                                                                                                                                                                               
					}                                                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                               
					promise.resolve(result);                                                                                                                                                                                                                                  
				},                                                                                                                                                                                                                                                         
				error: (error) => {                                                                                                                                                                                                                                        
					// error occured => reject the promise                                                                                                                                                                                                                    
					//result = me._buildMockData();                                                                                                                                                                                                                           
					promise.reject(error);                                                                                                                                                                                                                                    
					//promise.reject(error);                                                                                                                                                                                                                                  
				}                                                                                                                                                                                                                                                          
			});                                                                                                                                                                                                                                                         
			return promise;                                                                                                                                                                                                                                             
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		createData: function (set, requestBody, that, url) {                                                                                                                                                                                                         
			const baseUrl = url ? url : constants.service.url;                                                                                                                                                                                                          
			const oModel = new sap.ui.model.odata.ODataModel(baseUrl, true);                                                                                                                                                                                            
			let promise = jQuery.Deferred();                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
			oModel.create("/" + set, requestBody, {                                                                                                                                                                                                                     
				success: (data) => {                                                                                                                                                                                                                                       
					// call was successfull => resolve the promise using the result                                                                                                                                                                                           
					let result = JSON.parse(JSON.stringify(data));                                                                                                                                                                                                            
					promise.resolve(result);                                                                                                                                                                                                                                  
				},                                                                                                                                                                                                                                                         
				error: (error) => {                                                                                                                                                                                                                                        
					// error occured => reject the promise                                                                                                                                                                                                                    
					promise.reject(error);                                                                                                                                                                                                                                    
				}                                                                                                                                                                                                                                                          
			});                                                                                                                                                                                                                                                         
			return promise;                                                                                                                                                                                                                                             
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		_buildMockData: function () {                                                                                                                                                                                                                                
			const lgnumData = {                                                                                                                                                                                                                                         
				"results": [                                                                                                                                                                                                                                               
					{ Name: "1000" },                                                                                                                                                                                                                                         
					{ Name: "VI02" },                                                                                                                                                                                                                                         
					{ Name: "ZLTP" },                                                                                                                                                                                                                                         
					{ Name: "ZSAP" },                                                                                                                                                                                                                                         
					{ Name: "OTPK" },                                                                                                                                                                                                                                         
				]                                                                                                                                                                                                                                                          
			};                                                                                                                                                                                                                                                          
			return lgnumData;                                                                                                                                                                                                                                           
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		handleError: function (err) {                                                                                                                                                                                                                                
			const errText = err.response ? JSON.parse(err.response.body).error.message.value : JSON.parse(err.responseText).error.message.value;                                                                                                                        
			MessageBox.show(                                                                                                                                                                                                                                            
				errText, {                                                                                                                                                                                                                                                 
				icon: MessageBox.Icon.ERROR,                                                                                                                                                                                                                               
				title: "Error",                                                                                                                                                                                                                                            
				actions: [MessageBox.Action.OK]                                                                                                                                                                                                                            
			})                                                                                                                                                                                                                                                          
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		showMessage: function (message, type, messagebox) {                                                                                                                                                                                                          
			var oMessage = new Message({                                                                                                                                                                                                                                
				message: message,                                                                                                                                                                                                                                          
				type: type,                                                                                                                                                                                                                                                
				target: "/Dummy",                                                                                                                                                                                                                                          
				processor: this.getView().getModel()                                                                                                                                                                                                                       
			});                                                                                                                                                                                                                                                         
			sap.ui.getCore().getMessageManager().addMessages(oMessage);                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
			if (messagebox) {                                                                                                                                                                                                                                           
				MessageBox.error(message);                                                                                                                                                                                                                                 
			} else {                                                                                                                                                                                                                                                    
				var oHL = this.getView().byId("hbox1");                                                                                                                                                                                                                    
				var oMs = sap.ui.getCore().byId("msgStrip");                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
				if (oMs) {                                                                                                                                                                                                                                                 
					oMs.destroy();                                                                                                                                                                                                                                            
				}                                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
				var oMsgStrip = new sap.m.MessageStrip("msgStrip", {                                                                                                                                                                                                       
					text: message,                                                                                                                                                                                                                                            
					showCloseButton: false,                                                                                                                                                                                                                                   
					showIcon: false,                                                                                                                                                                                                                                          
					type: type                                                                                                                                                                                                                                                
				});                                                                                                                                                                                                                                                        
				oHL.addItem(oMsgStrip);                                                                                                                                                                                                                                    
			}                                                                                                                                                                                                                                                           
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		getTranslatedText: function (key) {                                                                                                                                                                                                                          
            return this.getOwnerComponent().getModel("i18n").getProperty(key);                                                                                                                                                                                 
        },                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
		onMessagePopoverPress: function (oEvent) {                                                                                                                                                                                                                   
			this._getMessagePopover().openBy(oEvent.getSource());                                                                                                                                                                                                       
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		_getMessagePopover: function () {                                                                                                                                                                                                                            
			// create popover lazily (singleton)                                                                                                                                                                                                                        
			if (!this._oMessagePopover) {                                                                                                                                                                                                                               
				this._oMessagePopover = sap.ui.xmlfragment(this.getView().getId(),                                                                                                                                                                                         
					"z_vi02_sampling.view.MessagePopover", this);                                                                                                                                                                                                             
				this.getView().addDependent(this._oMessagePopover);                                                                                                                                                                                                        
			}                                                                                                                                                                                                                                                           
			return this._oMessagePopover;                                                                                                                                                                                                                               
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
		enableElement: function (Element) {                                                                                                                                                                                                                          
			var oModel = this.getElementsModel();                                                                                                                                                                                                                       
			var propertyString = "/" + Element + "/enabled";                                                                                                                                                                                                            
			oModel.setProperty(propertyString, true);                                                                                                                                                                                                                   
			oModel.refresh(true);                                                                                                                                                                                                                                       
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		disableElement: function (Element) {                                                                                                                                                                                                                         
			var oModel = this.getElementsModel();                                                                                                                                                                                                                       
			var propertyString = "/" + Element + "/enabled";                                                                                                                                                                                                            
			oModel.setProperty(propertyString, false);                                                                                                                                                                                                                  
			oModel.refresh(true);                                                                                                                                                                                                                                       
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		toggleButton: function (Element, toggle) {                                                                                                                                                                                                                   
			var oModel = this.getElementsModel();                                                                                                                                                                                                                       
			var propertyString = "/" + Element + "/pressed";                                                                                                                                                                                                            
			oModel.setProperty(propertyString, toggle);                                                                                                                                                                                                                 
			oModel.refresh(true);                                                                                                                                                                                                                                       
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		handleMessageResponse: function handleMessageResponse(response, messagebox) {                                                                                                                                                                                
			var errorCodeInvalidRange = "9FB7E23B75B7157FE10000000A11447B";                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
			if (!response.headers) {                                                                                                                                                                                                                                    
				response = response.response;                                                                                                                                                                                                                              
			}                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
			var isThereSuccessMessage = !!response.headers["sap-message"];                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
			if (isThereSuccessMessage) {                                                                                                                                                                                                                                
				var sapMessages = JSON.parse(response.headers["sap-message"]);                                                                                                                                                                                             
				var sapMessagesArr = sapMessages.details;                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                               
				if (sapMessagesArr && sapMessagesArr instanceof Array) {                                                                                                                                                                                                   
					sapMessagesArr.forEach(function (messageObj) {                                                                                                                                                                                                            
						sapMessages.message += "\n" + messageObj.message;                                                                                                                                                                                                        
					});                                                                                                                                                                                                                                                       
				}                                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
				//this.createMessageBox(sapMessages);                                                                                                                                                                                                                      
			} else {                                                                                                                                                                                                                                                    
				var property = null;                                                                                                                                                                                                                                       
				response.hasOwnProperty("responseText") ? property = "responseText" : property = "body";                                                                                                                                                                   
                                                                                                                                                                                                                                                               
				if (response[property].includes("error")) {                                                                                                                                                                                                                
					var error = JSON.parse(response[property]);                                                                                                                                                                                                               
					var message = error.error.message.value;                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                               
					if (error.error.code.includes(errorCodeInvalidRange)) {                                                                                                                                                                                                   
						message = "Invalid Value";                                                                                                                                                                                                                               
					}                                                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                               
					this.showMessage(message, "Error", messagebox);                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
				}                                                                                                                                                                                                                                                          
			}                                                                                                                                                                                                                                                           
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
		_statusCodeSwitch(errorData) {                                                                                                                                                                                                                               
			const statusCode = errorData.response.statusCode;                                                                                                                                                                                                           
			let error = {                                                                                                                                                                                                                                               
				code: statusCode,                                                                                                                                                                                                                                          
				title: errorData.response.statusText                                                                                                                                                                                                                       
			}                                                                                                                                                                                                                                                           
			let errorText = "There was an error while executing your request."                                                                                                                                                                                          
			switch (statusCode) {                                                                                                                                                                                                                                       
				case 400: break;                                                                                                                                                                                                                                           
				case 500:                                                                                                                                                                                                                                                  
					errorData = JSON.parse(errorData.response.body).error;                                                                                                                                                                                                    
					errorText = "Code: " + errorData.code + "\nReason: " + errorData.message.value;                                                                                                                                                                           
					break;                                                                                                                                                                                                                                                    
				default:                                                                                                                                                                                                                                                   
					errorText = "Default Error Text"                                                                                                                                                                                                                          
			}                                                                                                                                                                                                                                                           
			error.errorText = errorText;                                                                                                                                                                                                                                
			return error;                                                                                                                                                                                                                                               
		},                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
	});                                                                                                                                                                                                                                                           
});                                                                                                                                                                                                                                                            